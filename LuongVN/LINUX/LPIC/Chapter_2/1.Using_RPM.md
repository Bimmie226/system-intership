# USING RPM
Được phát triển bởi Red Hat, cho phép cài đặt, chỉnh sửa và gỡ bỏ các gói phần mềm.

## RPM Distributions and Conventions
### Cấu trúc tên file RPM:
File RPM có đuôi `.rpm` và tuân theo định dạng:
```pgsql
PACKAGE-NAME-VERSION-RELEASE.ARCHITECTURE.rpm
```
- **PACKAGE-NAME**: Tên gọi phần mềm(Ví dụ `emacs`) 
  
  Lưu ý: tên gói có thể khác nhau giữa các bản phân phối, và không nhất thiết trùng với tên chương trình.
- **VERSION**: Phiên bản của phần mềm, thể hiện các thay đổi lớn hơn so với các phiên bản cũ.

  Ví dụ: `1.13.1`.
- **RELEASE**: Số phát hành, thể hiện thay đổi nhưng nhỏ hơn so với version
- **ARCHITECTURE**: Kiến trúc CPU

  Ví dụ: `x86_64`: bộ xử lý 64 bit

### Loại gói RPM
Có hai loại gói RPM:
1) **Binary RPM**: Chứa chương trình đã biên dịch - dùng để cài đặt và chạy trực tiếp.
2) **Source RPM(SRPM)**: chứa mã nguồn, dùng để phân tích hoặc tùy chỉnh gói phần mềm.
          -> Gói SRPM có chữ `src` trong phần kiến trúc file.

## The rpm Command Set
### Công cụ chính `rpm`
- `rpm` là chương trình dòng lệnh dùng để cài đặt, gỡ bỏ và kiểm tra các gói phần mềm RPM.
- Cú pháp cơ bản:
  ```bash
  rpm ACTION [OPTION] PACKAGE-FILE
  ```
  -> Trong đó, ACTION là hành động bạn muốn thực hiện (cài đặt, gỡ, kiểm tra…). 

### Các ACTION phổ biến
| Viết tắt | Dạng đầy đủ | Mô tả                                                           |
| -------- | ----------- | --------------------------------------------------------------- |
| `-e`     | `--erase`   | Gỡ bỏ gói phần mềm đã cài đặt                                   |
| `-F`     | `--freshen` | Cập nhật gói **chỉ khi** hệ thống đã có phiên bản cũ hơn        |
| `-i`     | `--install` | Cài đặt gói được chỉ định                                       |
| `-q`     | `--query`   | Kiểm tra xem gói đã được cài đặt hay chưa                       |
| `-U`     | `--upgrade` | Cài đặt **hoặc nâng cấp** gói (nếu đã có phiên bản cũ hơn)      |
| `-V`     | `--verify`  | Xác minh xem các file của gói có còn đầy đủ và nguyên vẹn không |

### Installing and Updating RPM Packages
1) Điều kiện để sử dụng lệnh `rpm`
- Trước khi dùng lệnh `rpm`, phải cài đặt file `.rpm` đã tải về máy.
- Lệnh được dùng:
  - `rpm -i` -> cài đặt mới một gói phần mềm.
  - `rpm -U` -> cài đặt hoặc cập nhật nếu gói đã có sẵn.
  
2) Quyền thực thi(superuser privileges)
- Để cài đặt hoặc cập nhật phần mềm, bạn phải có quyền quản trị(root).
- Có thể:
  - Đặng nhập bằng tk root
  - Dùng lệnh `sudo`(nếu tk được cấp quyền này)
  
### Querying RPM Packages
Lệnh `rpm -q` - Truy vấn thông tin gói RPM

- Lệnh `rpm` với option `-q`(query) dùng để kiểm tra thông tin các gói phần mềm đã cài đặt trên hệ thống.

```bash
# rpm -q zsh
zsh-5.0.2-31.el7.x86_64
```
-> Có nghĩa là gói `zsh` đang được cài đặt với phiên bản `5.0.2-31`

Nếu gói chưa cài đặt, sẽ thấy:
```bash
# rpm -q docker
package docker is not installed
```

Thêm tùy chọn `-i` để xem chi tiết các gói

![alt text](../images/2_1_01.png)

Xác định cấu hình của các gói đã cài đặt `-c`

![alt text](../images/2_1_02.png)

### Verifying RPM Packages 
Lệnh kiểm tra tính toàn vẹn gón RPM
- Cú pháp:
```bash
rpm -V <tên_gói>
```
- Ví dụ:
```bash
rpm -V zsh
```
- Ý nghĩa:
  - Lệnh này so sánh thông tin hiện tại của các file với các thông tin gốc được ghi trong cơ sở dũ liệu của RPM khi cài đặt.
  - Nếu không có gì xuất ra -> mọi thứ đều nguyên vẹn
- Bảng mã phản hồi:

|  Ký hiệu  | Ý nghĩa                                       |
| :-------: | :-------------------------------------------- |
|    `?`    | Không thể kiểm tra được                       |
|    `5`    | Thay đổi giá trị *digest* (checksum SHA256)   |
|    `c`    | File cấu hình (config file)                   |
|    `D`    | Số thiết bị (major/minor) thay đổi            |
|    `G`    | Nhóm sở hữu (group) thay đổi                  |
|    `L`    | Liên kết (link path) thay đổi                 |
| `missing` | File bị mất                                   |
|    `M`    | Quyền truy cập (mode) hoặc loại file thay đổi |
|    `P`    | Quyền năng (capabilities) thay đổi            |
|    `S`    | Kích thước file thay đổi                      |
|    `T`    | Thời gian chỉnh sửa (timestamp) thay đổi      |
|    `U`    | Chủ sở hữu (user) thay đổi                    |

- Ví dụ:
```bash
# rpm -V zsh
.....UGT.   /bin/zsh
.......T. c /etc/zlogin
missing     c /etc/zprofile
```

- `/bin/zsh` -> UGT -> user thay đổi, group thay đổi, thời gian chỉnh sửa thay đổi
- `/etc/zlogin` -> chỉ thời gian chỉnh sửa thay đổi
- `/etc/zprofile` -> bị mất hoàn toàn(missing)

### Removing RPM Packages
Để xóa 1 gói đã cài đặt, sử dụng tùy chọn `-e`

![alt text](../images/2_1_03.png)

## Extracting Data from RPMs
Giải nén tập `rpm` mà không cần cài đặt nó. Tiện ích `rpm` rất hữu ích trong những trường hợp này. Nó cho phép ta tạo 1 file mở rộng là `.cpio` để lưu trữ.

```bash
rpm2cpio httpd-2.4.62-4.el9_6.4.x86_64.rpm > httpd.cpio
```
- `rpm2cpio` là công cụ chuyển đổi định dạng `.rpm` -> `.cpio`

Giải nén file `cpio` ra thư mục hiện tại

![alt text](../images/2_1_04.png)

- `-i`: copy-in mode (giải nén)

- `-d`: tạo thư mục con khi cần thiết

- `-v`: verbose — hiển thị chi tiết các file đang được giải nén

- `< httpd.cpio`: lấy dữ liệu đầu vào từ file cpio


## Using YUM
### Hạn chế của `rpm`:
- Người dùng tự tìm các gói phần mềm muốn cài.
- Nếu một gói phụ thuộc vào gói khác, phải tự tải và cài theo đúng thứ tự -> bất tiện.

### Sự ra đời của `repository`
- Mỗi bản phân phối Linux có một kho (repository) 
- Nhờ có repository, người dùng có thể tải và cài đặt phần mềm chỉ bằng một lệnh, hệ thống sẽ tự động xử lý các phụ thuộc.

### Giới thiệu về `YUM`
- YUM(Yellowdog Update Manager) là công cụ trung tâm dùng cho hệ thống Red Hat và các distro
- Cung cấp lệnh `yum` để truy vấn, cài đặt, cập nhật và gỡ bỏ gói phần mềm trực tiếp từ repository.

### Cú pháp cơ bản của `yum`
```bash
yum [OPTION] [COMMAND] [PACKAGE...]
```

1) Kiểm tra các cập nhật

- Kiểm tra các gói nào đã cài đặt đang có sẵn phiên bản cập nhật
```bash
[root@localhost ~]# yum check-update
```

- Cập nhật tất cả các gói đã cài đặt
```bash
[root@localhost ~]# yum update
```

- Cập nhật một gói cụ thể hoặc 1 phiên bản cụ thể của gói

```bash
[root@localhost ~]# yum update [tên gói]
```

2) Cài đặt gói
- Cài đặt 1 gói hoặc phiên bản cụ thể của gói
```bash
[root@localhost ~]# yum install [gói]
```

- Cài đặt gói mà không cần xác nhận
```bash
[root@localhost ~]# yum -y install [gói]
```

3. Liệt kê gói
- Để tìm kiếm 1 gói cụ thể ta dùng list
```bash
[root@localhost ~]# yum list [gói]
```
4. Xem thông tin gói
- Để biết thông tin 1 gói trước khi ta cài đặt nó, ta sử dụng info
```bash
[root@localhost ~]# yum info [gói]
```
5. Xóa gói bằng yum
- Lệnh này sẽ xóa gói được chỉ định cùng với tất cả các phụ thuộc của nó
```bash
[root@localhost ~]# yum remove [tên gói]
```
