# UNDERSTANDING FILESYSTEMS
## The Virtual Directory
- Trong Linux, tất cả dữ liệu được tổ chức trong một cây thư mục duy nhất, bắt đầu từ thư mục gốc `/` – gọi là virtual directory structure.
- Các thiết bị vật lý (ổ cứng, USB, CD...) được gắn vào hệ thống thông qua mount point — là thư mục trung gian liên kết thiết bị với cây thư mục ảo.
- Để thống nhất cấu trúc này, Linux sử dụng Filesystem Hierarchy Standard (FHS), quy định các thư mục cốt lõi và chức năng của chúng:

| Thư mục                                       | Chức năng                            |
| --------------------------------------------- | ------------------------------------ |
| `/boot`                                       | Chứa file khởi động hệ thống         |
| `/etc`                                        | Cấu hình hệ thống và ứng dụng        |
| `/home`                                       | Dữ liệu người dùng                   |
| `/media`, `/mnt`                              | Mount thiết bị rời                   |
| `/opt`                                        | Ứng dụng bên thứ ba                  |
| `/tmp`                                        | File tạm                             |
| `/usr`, `/usr/bin`, `/usr/local`, `/usr/sbin` | Chương trình và dữ liệu hệ thống     |
| `/var`                                        | Log và dữ liệu thay đổi thường xuyên |

## Maneuvering Around the Filesystem
- Trong Linux, nhờ cấu trúc thư mục ảo, việc di chuyển hoặc sao chép file giữa các thiết bị trở nên rất đơn giản — không cần nhớ ổ C:, D: như Windows, chỉ cần biết đường dẫn (path) trong cây thư mục.
- Ví dụ:
  ```bash
  cp /home/rich/Documents/myfile.txt /media/usb
  ```
  -> sao chép file từ thư mục Documents sang USB
- Linux sử dụng hai kiểu đường dẫn:

| Kiểu đường dẫn    | Đặc điểm                                                             | Ví dụ                                            |
| ----------------- | -------------------------------------------------------------------- | ------------------------------------------------ |
| **Absolute path** | Bắt đầu bằng `/`, chỉ rõ toàn bộ đường dẫn từ thư mục gốc.           | `/home/rich/Documents/myfile.txt`                |
| **Relative path** | Không bắt đầu bằng `/`, tính theo **vị trí hiện tại** trong thư mục. | `myfile.txt` (nếu đang ở `/home/rich/Documents`) |

# FORMATTING FILESYSTEMS
## Common Filesystem Types
### Linux Filesystems
- Linux có nhiều loại hệ thống tệp (filesystem) khác nhau để quản lý dữ liệu trên ổ đĩa

| Filesystem   | Đặc điểm chính                                                                                           |
| ------------ | -------------------------------------------------------------------------------------------------------- |
| **ext4**     | Phổ biến nhất hiện nay, hỗ trợ journaling (ghi log phục hồi dữ liệu khi lỗi), kích thước tệp tới 16 TiB. |
| **ext3**     | Phiên bản cũ hơn của ext4, có journaling, ổn định.                                                       |
| **btrfs**    | Mới, hiệu suất cao, hỗ trợ RAID, LVM, snapshot, nén dữ liệu tự động.                                     |
| **reiserFS** | Cũ, ít dùng, đã ngừng hỗ trợ.                                                                            |
| **eCryptfs** | Mã hóa dữ liệu ở mức filesystem.                                                                         |
| **swap**     | Dùng làm bộ nhớ ảo, không lưu dữ liệu lâu dài.                                                           |

- **NOTE**: Mặc định hầu hết distro Linux dùng `ext4` vì ổn định và dễ phục hồi khi hệ thống lỗi.

### Non-Linux Filesystems
- Linux có thể đọc/ghi dữ liệu từ các hệ thống tệp của Windows, macOS, và các thiết bị khác:

| Filesystem            | Nguồn gốc / Mục đích                              |
| --------------------- | ------------------------------------------------- |
| **NTFS**              | Windows (đọc/ghi được trên Linux).                |
| **exFAT**, **VFAT**   | Dùng cho USB, thẻ SD.                             |
| **CIFS**, **SMB**     | Truy cập dữ liệu qua mạng (Windows file sharing). |
| **NFS**               | Chia sẻ dữ liệu mạng kiểu Linux/Unix.             |
| **HFS/HFS+**          | Hệ thống tệp của macOS.                           |
| **ISO-9660**, **UDF** | Dùng cho CD/DVD.                                  |
| **XFS**, **ZFS**      | Hiệu suất cao, dùng cho máy chủ và lưu trữ lớn.   |

- **NOTE**: Không nên định dạng ổ đĩa Linux bằng filesystem không thuộc Linux, trừ khi cần chia sẻ dữ liệu với hệ điều hành khác.

## Creating Filesystems
### Lệnh `mkfs`
- `mkfs` (make filesystem) là công cụ chính để tạo hệ thống tệp (filesystem) trong Linux.
- Cú pháp:
  ```bash
  sudo mkfs -t ext4 /dev/sdb1
  ```
  -> `-t` (type) dùng để chỉ loại filesystem (như ext4, xfs, btrfs, …).

# MOUNTING FILESYSTEMS
## Manually Mounting Devices
### Lệnh `mount`
- Dùng để gắn (mount) một phân vùng hay thiết bị vào hệ thống thư mục ảo của Linux.
- Cú pháp:
  ```bash
  sudo mount -t ext4 /dev/sdb1 /media/usb1
  ```
  → Gắn phân vùng `/dev/sdb1` vào thư mục `/media/usb1` với hệ thống tệp `ext4`.

### Lệnh `umount`
- Dùng để gỡ (unmout) thiết bị đã gắn
  ```bash
  sudo umount /media/usb1
  ```

## Automatically Mounting Devices
- `/etc/fstab` – File cấu hình để tự động mount thiết bị khi khởi động
  - Là "bảng kê" các thiết bị lưu trữ mà linux sẽ mount tự động khi boot.
  - Mỗi dòng trong file chứa các trường chính:
  ```php-template
  <device>   <mount point>   <filesystem type>   <options>   <dump>   <pass>
  ```
  - Ví dụ:
  ```ini
  UUID=46a8473c...   /           ext4    errors=remount-ro   0   1
  UUID=864B-62F5     /boot/efi   vfat    umask=0077          0   1
  UUID=8673447a...   none        swap    sw                  0   0
  ```

  - `UUID`: mã định danh duy nhất cho mỗi phân vùng (ổ đĩa). Dùng để tránh nhầm nếu thứ tự ổ thay đổi.

  - `Mount point`: nơi ổ đĩa sẽ xuất hiện trong hệ thống ảo (ví dụ /, /boot/efi, /mnt/data).

  - `Type`: loại hệ thống tệp (ext4, vfat, ntfs, swap,...).

  - `Options`: tùy chọn mount (ví dụ ro – read-only, rw – read/write, noauto, user,...).

  - `Dump / Pass`: dùng cho kiểm tra và backup hệ thống (thường để 0 và 1).
- Khi thêm thiết bị mới:
  - Có thể thêm thủ công 1 dòng vào `/etc/fstab`:
    ```ini
    UUID=1234-ABCD   /mnt/usb   ext4   defaults   0   0
    ```
    -> Khi khởi động lại, Linux tự mount ổ USB đó vào `/mnt/usb`

# MANGAGING FILESYSTEMS
## Retrieving Filesystem Stats
- Kiểm tra thống kê hệ thống tệp
- Các lệnh chính:
  - `df` - Hiển thị dung lượng ổ đĩa theo phân vùng
  - `du` - Hiển thị dung lượng thư mục hoặc file, giúp tìm thư mục chiếm nhiều chỗ.
  - `iostat` – Theo dõi hiệu suất I/O của từng ổ đĩa theo thời gian thực.
  - `lsblk` – Liệt kê ổ đĩa, phân vùng, và mount point hiện có.

## Filesystems Tools
- Công cụ quản lý hệ thống tệp trong linux

1) Bộ công cụ cho `ext3/ext4`
- `blkid` – Hiển thị thông tin ổ đĩa (UUID, định dạng, v.v.)
- `chattr` – Thay đổi thuộc tính file (ví dụ: chống xóa, chỉ đọc)
- `debugfs` – Xem và sửa cấu trúc hệ thống tệp (có thể khôi phục file bị xóa)
- `dumpe2fs` – Xem thông tin nhóm block và superblock
- `e2label` – Đặt hoặc đổi nhãn (label) cho hệ thống tệp
- `resize2fs` – Thay đổi kích thước hệ thống tệp (mở rộng hoặc thu nhỏ)
- `tune2fs` – Tinh chỉnh các tham số của hệ thống tệp

2) Bộ công cụ cho `xfs filesystem`
- `xfs_admin` – Hiển thị hoặc đổi nhãn/UUID
- `xfs_db` – Gỡ lỗi (debug) hệ thống tệp XFS
- `xfs_fsr` – Tối ưu, sắp xếp lại dữ liệu trong filesystem
- `xfs_info` – Hiển thị thông tin chi tiết về block, sector, label, UUID
- `xfs_repair` – Sửa lỗi hệ thống tệp XFS bị hỏng

3) `fsck` - Kiểm tra và sửa lỗi hệ thống tệp
- lệnh tổng quát:
  ```bash
  sudo fsck -f /dev/sdb1
  ```
- Tự động gọi chương trình kiểm tra phù hợp (như các công cụ cho `ext4`).
- Nếu có lỗi, có thể chạy lại `fsck` nhiều lần để sửa.
