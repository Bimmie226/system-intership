# LOOKING AT SSH
## Exploring Basic SSH Concepts
## Configuring SSH
- Các file cấu hình chính:
  - `~/.ssh/config` — cấu hình client cho từng user.

  - `/etc/ssh/ssh_config` — cấu hình client hệ thống (tất cả user), có thể bị ghi đè bởi `~/.ssh/config`.

  - `/etc/ssh/sshd_config` — cấu hình sshd (server) cho kết nối đến.
- Các directive quan trọng trong `sshd_config`:
  - `PermitRootLogin` (→ no)

  - `Port` (mặc định 22)

  - `PasswordAuthentication` (→ `no` nếu bạn đã bật key auth)

  - `PermitEmptyPasswords no`

  - `PubkeyAuthentication yes`

- Khi 1 client muốn kết nối tới server ta có thể tạo và cấu hình `~/.ssh/config`

  ```bash
  Host myserver
    HostName 192.168.174.136
    Port 2222
    User luongvn
    IdentityFile ~/.ssh/id_rsa
  ```

- Đối với kết nối của mọi người dùng tới hệ thống từ xa, hãy tạo và sửa đổi file `/etc/ssh/ssh_config` của phía máy khách.

- Khi ảnh hưởng đến việc client ssh vào server, ta chỉnh sửa file `/etc/ssh/sshd_config`

## Generating SSH Keys

https://github.com/Bimmie226/system-intership/blob/main/LuongVN/NETWORK/13.SSH/Lab/ssh_server_only_key.md

## Authenticating with SSH Keys

https://github.com/Bimmie226/system-intership/blob/main/LuongVN/NETWORK/13.SSH/SSH_protocol/docs.md#vi-c%C3%A1ch-th%E1%BB%B1c-ho%E1%BA%A1t-%C4%91%E1%BB%99ng-c%E1%BB%A7a-ssh-key

## Authenticating with ssh agent
- Nếu Private Key có passphrase, mỗi lần SSH, ta cần phải nhập lại passphrase đó.
- `ssh-agent` là 1 tiến trình nền chuyên:
  - Giữ private key trong RAM
  - Giúp SSH nhiều lần mà không chỉ cần nhập passphrase 1 lần duy nhất
- Các bước xác thực:

  - Đăng nhập vào hệ thống máy khách SSH
  - Tạo cặp khóa SSH ID và thiết lập cụm mật khẩu
  - Chuyển khóa SSH công khai đến máy chủ SSH
  - Đăng nhập vào hệ thống máy churu SSH
  - Thêm khóa SSH công khai vào tệp `~/.ssh/authorized_keys` trên hệ thống máy chủ.
  - Bắt đầu một phiên 
  - Thêm khóa SSH vào session agent.

## Using GPG
- Khi muốn nén 1 file và gửi file vượt quá khả năng của `scp` ta sử dụng `GPG`

### Generating Keys
- Tạo cặp khóa GPG: `gpg --gen-key`
- Khởi tạo 1 cặp khóa:
  - public key
  - private key

- Nơi lưu khóa: `~/.gnupg/`
  - `pubring.kbx`: public keyring
  - `private-keys-v1.d/`: thư mục khóa riêng

###  Importing Keys
- Khi ta nhận được khóa công khai để mã hóa tệp, hãy thêm nó vào khóa của mình trước khi sử dụng.

  ```bash
  gpg --import FILENAME.pub
  ```

###  Encrypting and Decrypting Data
- Mã hóa file để gửi cho người khác:
  - Dùng public key của người nhận:

    ```bash
    gpg --out encryptfile --recipient rb4242@gmail.com --encrypt secretfile.txt
    ```

    - `secretfile.txt`: file gốc (chưa mã hóa)

    - `encryptfile`: file đã mã hóa

    - `rb4242@gmail.com`: email của người nhận (dùng để tìm public key)   
- Giải mã file:
  - Dùng private key của người nhận:

    ```bash
    gpg --out CBmessage.txt --decrypt encryptfile
    ```

  - GPG yêu cầu passphrase của private key sau đó file được giải mã thành `CBmessage.txt`